{"version":3,"file":"create-reference.js","sourceRoot":"","sources":["../../../../src/database/list/create-reference.ts"],"names":[],"mappings":"AACA,OAAO,EAAE,eAAe,EAAE,MAAM,oBAAoB,CAAC;AACrD,OAAO,EAAE,kBAAkB,EAAE,MAAM,iBAAiB,CAAC;AACrD,OAAO,EAAE,gBAAgB,EAAE,MAAM,eAAe,CAAC;AACjD,OAAO,EAAE,yBAAyB,EAAE,MAAM,kBAAkB,CAAC;AAC7D,OAAO,EAAE,kBAAkB,EAAE,MAAM,UAAU,CAAC;AAG9C,MAAM,8BAAiC,KAAoB,EAAE,UAA+B;IAC1F,MAAM,CAAC;QACL,KAAK,OAAA;QACL,MAAM,EAAE,yBAAyB,CAAa,KAAK,CAAC,GAAG,EAAE,QAAQ,CAAC;QAClE,GAAG,EAAE,yBAAyB,CAAI,KAAK,CAAC,GAAG,EAAE,KAAK,CAAC;QACnD,IAAI,EAAE,UAAC,IAAO,IAAK,OAAA,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,EAApB,CAAoB;QACvC,MAAM,EAAE,kBAAkB,CAAC,KAAK,CAAC,GAAG,CAAC;QACrC,eAAe,YAAC,MAAqB;YACnC,IAAM,gBAAgB,GAAG,eAAe,CAAC,KAAK,EAAE,MAAM,CAAC,CAAC;YACxD,MAAM,CAAC,UAAU,CAAC,SAAS,CAAC,sBAAsB,CAChD,UAAU,CAAC,SAAS,CAAC,iBAAiB,CACpC,gBAAgB,CACjB,CACF,CAAC;SACH;QACD,YAAY,EAAE,kBAAkB,CAAC,KAAK,EAAE,UAAU,CAAC;QACnD,UAAU,EAAE,gBAAgB,CAAC,KAAK,EAAE,UAAU,CAAC;QAC/C,YAAY,EAAZ,UAAgB,MAAqB;YACnC,IAAM,gBAAgB,GAAG,eAAe,CAAC,KAAK,EAAE,MAAM,CAAC,CAAC;YACxD,MAAM,CAAC,UAAU,CAAC,SAAS,CAAC,sBAAsB,CAChD,UAAU,CAAC,SAAS,CAAC,iBAAiB,CACpC,gBAAgB,CACjB,CACF,CAAC,GAAG,CAAC,UAAA,OAAO,IAAI,OAAA,OAAO,CAAC,GAAG,CAAC,UAAA,CAAC,IAAI,OAAA,CAAC,CAAC,OAAO,CAAC,GAAG,EAAE,EAAf,CAAe,CAAC,EAAjC,CAAiC,CAAC,CAAC;SACrD;KACF,CAAA;CACF","sourcesContent":["import { DatabaseQuery, AngularFireList, ChildEvent } from '../interfaces';\r\nimport { snapshotChanges } from './snapshot-changes';\r\nimport { createStateChanges } from './state-changes';\r\nimport { createAuditTrail } from './audit-trail';\r\nimport { createDataOperationMethod } from './data-operation';\r\nimport { createRemoveMethod } from './remove';\r\nimport { AngularFireDatabase } from '../database';\r\n\r\nexport function createListReference<T>(query: DatabaseQuery, afDatabase: AngularFireDatabase): AngularFireList<T> {\r\n  return {\r\n    query,\r\n    update: createDataOperationMethod<Partial<T>>(query.ref, 'update'),\r\n    set: createDataOperationMethod<T>(query.ref, 'set'),\r\n    push: (data: T) => query.ref.push(data),\r\n    remove: createRemoveMethod(query.ref),\r\n    snapshotChanges(events?: ChildEvent[]) {\r\n      const snapshotChanges$ = snapshotChanges(query, events);\r\n      return afDatabase.scheduler.keepUnstableUntilFirst(\r\n        afDatabase.scheduler.runOutsideAngular(\r\n          snapshotChanges$\r\n        )\r\n      );\r\n    },\r\n    stateChanges: createStateChanges(query, afDatabase),\r\n    auditTrail: createAuditTrail(query, afDatabase),\r\n    valueChanges<T>(events?: ChildEvent[]) { \r\n      const snapshotChanges$ = snapshotChanges(query, events);\r\n      return afDatabase.scheduler.keepUnstableUntilFirst(\r\n        afDatabase.scheduler.runOutsideAngular(\r\n          snapshotChanges$\r\n        )\r\n      ).map(actions => actions.map(a => a.payload.val()));\r\n    }\r\n  }\r\n}\r\n"]}