{"version":3,"file":"document.spec.js","sourceRoot":"","sources":["../../../../src/firestore/document/document.spec.ts"],"names":[],"mappings":"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","sourcesContent":["import { FirebaseApp, FirebaseAppConfig, AngularFireModule } from 'angularfire2';\r\nimport { AngularFirestore } from '../firestore';\r\nimport { AngularFirestoreModule } from '../firestore.module';\r\nimport { AngularFirestoreDocument } from '../document/document';\r\n\r\nimport { FirebaseApp as FBApp } from '@firebase/app-types';\r\nimport { Observable } from 'rxjs/Observable';\r\nimport { Subscription } from 'rxjs/Subscription';\r\n\r\nimport { TestBed, inject } from '@angular/core/testing';\r\nimport { COMMON_CONFIG } from '../test-config';\r\n\r\nimport { Stock, randomName, FAKE_STOCK_DATA } from '../utils.spec';\r\n\r\ndescribe('AngularFirestoreDocument', () => {\r\n  let app: FBApp;\r\n  let afs: AngularFirestore;\r\n  let sub: Subscription;\r\n\r\n  beforeEach(() => {\r\n    TestBed.configureTestingModule({\r\n      imports: [\r\n        AngularFireModule.initializeApp(COMMON_CONFIG),\r\n        AngularFirestoreModule.enablePersistence()\r\n      ]\r\n    });\r\n    inject([FirebaseApp, AngularFirestore], (_app: FBApp, _afs: AngularFirestore) => {\r\n      app = _app;\r\n      afs = _afs;\r\n    })();\r\n  });\r\n\r\n  afterEach(async (done) => {\r\n    await app.delete();\r\n    done();\r\n  });\r\n\r\n  it('should get action updates', async (done: any) => {\r\n    const randomCollectionName = randomName(afs.firestore);\r\n    const ref = afs.firestore.doc(`${randomCollectionName}/FAKE`);\r\n    const stock = new AngularFirestoreDocument<Stock>(ref, afs);\r\n    await stock.set(FAKE_STOCK_DATA);\r\n    const sub = stock\r\n      .snapshotChanges()\r\n      .subscribe(async a => {\r\n        sub.unsubscribe();\r\n        if (a.payload.exists) {\r\n          expect(a.payload.data()).toEqual(FAKE_STOCK_DATA);\r\n          stock.delete().then(done).catch(done.fail);\r\n        }\r\n      });\r\n  });\r\n\r\n  it('should get unwrapped snapshot', async (done: any) => {\r\n    const randomCollectionName = afs.firestore.collection('a').doc().id;\r\n    const ref = afs.firestore.doc(`${randomCollectionName}/FAKE`);\r\n    const stock = new AngularFirestoreDocument<Stock>(ref, afs);\r\n    await stock.set(FAKE_STOCK_DATA);\r\n    const obs$ = stock.valueChanges();\r\n    obs$.take(1).subscribe(async (data: Stock) => {\r\n      expect(JSON.stringify(data)).toBe(JSON.stringify(FAKE_STOCK_DATA));\r\n      stock.delete().then(done).catch(done.fail);\r\n    });\r\n  });\r\n\r\n});\r\n"]}