{"version":3,"file":"firebase_list_observable.js","sourceRoot":"","sources":["../../../../src/database-deprecated/firebase_list_observable.ts"],"names":[],"mappings":"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","sourcesContent":["import { Observable } from 'rxjs/Observable';\r\nimport { Operator } from 'rxjs/Operator';\r\nimport { Subscriber } from 'rxjs/Subscriber';\r\nimport { Subscription } from 'rxjs/Subscription';\r\nimport { Reference, DataSnapshot, ThenableReference } from '@firebase/database-types';\r\nimport * as utils from './utils';\r\nimport { AFUnwrappedDataSnapshot, FirebaseOperationCases, QueryReference, DatabaseSnapshot, DatabaseReference } from './interfaces';\r\n\r\nexport type FirebaseOperation = string | Reference | DataSnapshot | AFUnwrappedDataSnapshot;\r\n\r\nexport class FirebaseListObservable<T> extends Observable<T> {\r\n  constructor(public $ref: QueryReference, subscribe?: <R>(subscriber: Subscriber<R>) => Subscription | Function | void) {\r\n    super(subscribe);\r\n  }\r\n  lift<T, R>(operator: Operator<T, R>): Observable<R> {\r\n    const observable = new FirebaseListObservable<R>(this.$ref);\r\n    observable.source = this;\r\n    observable.operator = operator;\r\n    observable.$ref = this.$ref;\r\n    return observable;\r\n  }\r\n\r\n  push(val:any):ThenableReference {\r\n    if(!this.$ref) {\r\n      throw new Error('No ref specified for this Observable!');\r\n    }\r\n    return this.$ref.ref.push(val);\r\n  }\r\n\r\n  set(item: FirebaseOperation, value: Object): Promise<void> {\r\n    return this._checkOperationCases(item, {\r\n      stringCase: () => this.$ref.ref.child(<string>item).set(value),\r\n      firebaseCase: () => (<Reference>item).set(value),\r\n      snapshotCase: () => (<DataSnapshot>item).ref.set(value),\r\n      unwrappedSnapshotCase: () => this.$ref.ref.child((<AFUnwrappedDataSnapshot>item).$key).set(value)\r\n    });\r\n  }\r\n\r\n  update(item: FirebaseOperation, value: Object): Promise<void> {\r\n    return this._checkOperationCases(item, {\r\n      stringCase: () => this.$ref.ref.child(<string>item).update(value),\r\n      firebaseCase: () => (<Reference>item).update(value),\r\n      snapshotCase: () => (<DataSnapshot>item).ref.update(value),\r\n      unwrappedSnapshotCase: () => this.$ref.ref.child((<AFUnwrappedDataSnapshot>item).$key).update(value)\r\n    });\r\n  }\r\n\r\n  remove(item?:FirebaseOperation): Promise<void> {\r\n    // if no item parameter is provided, remove the whole list\r\n    if (!item) {\r\n      return this.$ref.ref.remove();\r\n    }\r\n    return this._checkOperationCases(item, {\r\n      stringCase: () => this.$ref.ref.child(<string>item).remove(),\r\n      firebaseCase: () => (<DatabaseReference>item).remove(),\r\n      snapshotCase: () => (<DatabaseSnapshot>item).ref.remove(),\r\n      unwrappedSnapshotCase: () => this.$ref.ref.child((<AFUnwrappedDataSnapshot>item).$key).remove()\r\n    });\r\n  }\r\n\r\n  protected _checkOperationCases(item: FirebaseOperation, cases: FirebaseOperationCases) : Promise<void> {\r\n    if (utils.isString(item)) {\r\n      return cases.stringCase();\r\n    } else if (utils.isFirebaseRef(item)) {\r\n      return cases.firebaseCase!();\r\n    } else if (utils.isFirebaseDataSnapshot(item)) {\r\n      return cases.snapshotCase!();\r\n    } else if (utils.isAFUnwrappedSnapshot(item)) {\r\n      return cases.unwrappedSnapshotCase!()\r\n    }\r\n    throw new Error(`Method requires a key, snapshot, reference, or unwrapped snapshot. Got: ${typeof item}`);\r\n  }\r\n\r\n}\r\n"]}